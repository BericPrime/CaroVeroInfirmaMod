package net.dengusprime.caroveroinfirma.mixin;

import net.minecraft.core.BlockPos;
import net.minecraft.server.level.ServerLevel;
import net.minecraft.util.RandomSource;
import net.minecraft.world.level.Level;
import net.minecraft.world.level.block.entity.BlockEntity;
import net.minecraft.world.level.block.state.BlockState;
import org.dimdev.dimdoors.DimensionalDoors;
import org.dimdev.dimdoors.block.DetachedRiftBlock;
import org.dimdev.dimdoors.block.entity.DetachedRiftBlockEntity;
import org.dimdev.dimdoors.particle.client.RiftParticleOptions;
import org.dimdev.dimdoors.world.ModDimensions;
import org.spongepowered.asm.mixin.Mixin;
import org.spongepowered.asm.mixin.injection.At;
import org.spongepowered.asm.mixin.injection.Inject;
import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;

@Mixin(DetachedRiftBlockEntity.class)
public abstract class DetachedRiftBlockEntityMixin {

    @Inject(method = "onGrowth", at = @At("HEAD"), cancellable = true)
    private void speedUpGrowth(Level level, BlockPos pos, CallbackInfo ci) {
        DetachedRiftBlockEntity self = (DetachedRiftBlockEntity)(Object)this;

        // Cancel vanilla growth
        ci.cancel();

        // Do our own faster growth
        for (int n = 0; n < 10; ++n) {
            // 4Ã— growth speed, tweak as you like
            self.size = (float)((double)self.size +
                    (DimensionalDoors.getConfig().getGeneralConfig().riftGrowthSpeed * 4.0D) / (double)(self.size + 1.0F));
        }

        if (!level.isClientSide() && DimensionalDoors.getConfig().getGeneralConfig().enableRiftDecay) {
            self.applySpreadDecay((ServerLevel)level, pos);
        }
    }
}